# 청년국 전자투표 시스템 - 할 일 목록

## ✅ 완료된 작업

### 기본 설정 및 인프라
- [x] Next.js 프로젝트 생성
- [x] Supabase 프로젝트 생성 및 연결
- [x] 환경 변수 설정 (.env.local)
- [x] Tailwind CSS 설정
- [x] TypeScript 설정

### 데이터베이스
- [x] Supabase 스키마 설계 (supabase-schema.sql)
- [x] 7개 테이블 생성
  - [x] admin_emails (관리자)
  - [x] system_config (시스템 설정)
  - [x] villages (마을)
  - [x] elections (투표)
  - [x] candidates (후보자)
  - [x] voter_codes (참여코드)
  - [x] votes (투표 기록)
- [x] RLS 정책 설정
- [x] 인덱스 최적화
- [x] admin_emails 읽기 권한 추가

### 인증 시스템
- [x] Google OAuth 설정 (Supabase + Google Cloud Console)
- [x] 관리자 로그인 페이지 (/admin)
- [x] Google 로그인 기능 구현
- [x] 관리자 권한 확인 함수 (checkAdminAccess)
- [x] 로그아웃 기능
- [x] 세션 관리 (middleware)

### 페이지 구조
- [x] 홈페이지 (/)
- [x] 투표 페이지 (/vote) - UI만
- [x] 관리자 로그인 (/admin)
- [x] 관리자 대시보드 (/admin/dashboard)
- [x] 마을 관리 페이지 (/admin/villages)

### 관리자 기능
- [x] 대시보드 통계 표시
  - [x] 전체 투표 수
  - [x] 활성 투표 수
  - [x] 참여코드 수
  - [x] 마을 수
- [x] 마을 CRUD
  - [x] 마을 목록 조회
  - [x] 마을 추가
  - [x] 마을 삭제

---

## 🚀 Phase 1: 핵심 투표 기능 (최우선)

### 1. 투표 생성 및 관리 ✅
- [x] `/admin/elections` - 투표 목록 페이지
  - [x] 투표 목록 조회 (진행중/종료/전체)
  - [x] 투표 상태별 필터링
  - [x] 투표 삭제 기능
  - [ ] 투표 검색 기능 (선택사항)

- [x] `/admin/elections/create` - 투표 생성 페이지
  - [x] 투표 제목 입력
  - [x] 투표 유형 선택 (총대 선출 / 임원 선출)
  - [x] 마을 선택 (총대 선출인 경우)
  - [x] 직책 입력 (임원 선출인 경우)
  - [x] 라운드 설정 (1차, 2차 등)
  - [x] 최대 선택 수 설정
  - [x] 후보자 입력 (동적 추가/삭제)
  - [x] 투표 생성 API 구현
  - [x] 폼 유효성 검사

- [x] `/admin/elections/[id]` - 투표 상세 페이지
  - [x] 투표 정보 표시
  - [x] 후보자 목록
  - [x] 투표 상태 변경 (대기 → 등록중 → 진행중 → 종료)
  - [x] 후보자 추가/삭제
  - [x] 빠른 작업 링크 (모니터링, 결과, 코드관리)

### 2. 참여코드 생성 및 관리 ✅
- [x] `/admin/codes` - 참여코드 관리 페이지
  - [x] 코드 목록 조회
  - [x] 사용/미사용 필터링
  - [x] 코드 검색
  - [x] 코드 삭제
  - [x] 통계 대시보드 (전체/사용됨/미사용)

- [x] 참여코드 생성 기능 (기본)
  - [x] 단순 생성 모드
    - [x] 코드 타입 선택 (총대/임원)
    - [x] 생성 개수 입력
    - [x] 접근 가능한 투표 선택
    - [x] 마을 선택 (총대 코드인 경우)
    - [x] 일괄 생성 (nanoid 사용)
  - [x] 생성된 코드 목록 테이블로 표시
  
- [ ] 코드 출력 기능 (향후 추가)
  - [ ] CSV 업로드 모드 (이름과 함께 생성)
  - [ ] QR 코드 생성 (qrcode.react)
  - [ ] PDF 출력 (jspdf)
  - [ ] 인쇄용 HTML 뷰

### 3. 실제 투표 기능 (투표자용) ✅

- [x] `/vote` - 참여코드 입력 페이지
  - [x] 참여코드 입력 폼
  - [x] 코드 유효성 검사
  - [x] 에러 처리 (잘못된 코드, 이미 사용된 코드)

- [x] `/vote/[code]` - 투표 진행 페이지
  - [x] 참여코드로 접근 가능한 투표 목록 조회
  - [x] 투표 선택
  - [x] 후보자 목록 표시
  - [x] 후보자 선택 UI
    - [x] 단일 선택 (max_selections = 1)
    - [x] 복수 선택 (max_selections > 1)
    - [x] 선택 개수 제한 표시
  - [x] 투표 제출
  - [x] 중복 투표 방지
  - [x] 투표 완료 후 코드 사용 처리
  - [x] 득표수 자동 증가 (RPC 함수)

- [x] `/vote/complete` - 투표 완료 페이지
  - [x] 완료 메시지
  - [x] 투표 요약 정보

---

## 📊 Phase 2: 모니터링 및 결과

### 4. 실시간 투표 현황 ✅
- [x] `/admin/elections/[id]/monitor` - 실시간 모니터링
  - [x] 투표율 표시 (사용된 코드 / 전체 코드)
  - [x] 후보자별 득표 수
  - [x] 자동 새로고침 (10초마다)
  - [x] 수동 새로고침 버튼
  - [x] 마지막 업데이트 시간 표시
  - [x] 실시간 득표 진행바
  - [x] 현재 1위 강조 표시
  - [x] 통계 카드 (전체 코드, 투표 완료, 미투표, 투표율, 총 투표 수)
  - [ ] 실시간 득표 차트 (recharts) - 선택사항
    - [ ] 막대 그래프
    - [ ] 파이 차트

### 5. 투표 결과 ✅
- [x] `/admin/elections/[id]/results` - 결과 페이지
  - [x] 최종 득표 결과
  - [x] 당선자 표시 (max_selections 기준)
  - [x] 투표율 통계
  - [x] 마을별 투표율 (대의원 선출인 경우)
  - [x] 결과 진행바
  - [x] 득표율 계산 및 표시
  - [x] 투표 정보 요약
  - [x] 통계 카드 (전체 코드, 투표 완료, 미투표, 투표율, 투표자 수, 총 투표 수)
  - [ ] PDF 결과 보고서 생성 (선택사항)
  - [ ] 결과 공유 기능 (선택사항)

- [ ] `/results/[electionId]` - 공개 결과 페이지 (선택사항)
  - [ ] 투표자도 볼 수 있는 결과 페이지
  - [ ] 간단한 통계
  - [ ] 당선자 발표

---

## 🔧 Phase 3: 추가 기능 구현 (완료 - 100%) ✅

### 3.1 시스템 설정 페이지 ✅
- [x] `/admin/settings` - 기본 설정 페이지
  - [x] 시스템 이름 변경
  - [x] 관리자 이메일 관리
    - [x] 관리자 목록 조회
    - [x] 관리자 추가 (이메일 검증)
    - [x] 관리자 삭제 (보호 로직)
  - [x] 시스템 정보 표시
  - [x] 도움말 섹션
  - [x] 색상 테마 커스터마이징
    - [x] 메인 컬러 & 보조 컬러 설정
    - [x] 컬러 피커 UI (HTML5 color input)
    - [x] CSS 변수로 전역 색상 적용
    - [x] 실시간 미리보기
    - [x] 기본값 복구 기능
    - [x] ColorThemeSettings 컴포넌트
    - [x] ThemeProvider 컴포넌트

- [x] 로고 및 브랜딩 설정 ✅
  - [x] 로고 이미지 업로드 (Supabase Storage)
    - [x] 이미지 파일 선택 (PNG, JPG, SVG)
    - [x] Supabase Storage에 업로드 (`logos` 버킷)
    - [x] 업로드된 로고 URL system_config에 저장
    - [x] 로고 미리보기
    - [x] 기존 로고 삭제 및 교체 (자동)
    - [x] 파일 크기 제한 (2MB)
  - [x] 로고 표시 위치
    - [x] 투표자 페이지 헤더 (`/vote`)
    - [x] 관리자 대시보드 헤더 (`/admin/dashboard`)
    - [x] 모든 관리자 페이지 (투표, 마을, 코드, 설정)
    - [x] 로그인 페이지 (`/admin`)
    - [x] 홈페이지 (`/`)
  - [x] 로고 없을 시 기본 텍스트 표시
  - [x] SystemLogo 컴포넌트 생성 (크기별 자동 조정: sm, md, lg, xl)
  - [x] LogoUploadSettings 컴포넌트 생성

### 3.2 QR 코드 기능 ✅
- [x] qrcode.react 라이브러리 설치
- [x] 투표별 QR 코드 컴포넌트 (`QRCodeSection.tsx`)
  - [x] 투표 페이지 직접 접근 QR 생성
  - [x] PNG 다운로드 기능
  - [x] 인쇄용 페이지 생성
  - [x] URL 복사 기능
- [x] 메인 투표 페이지 QR 코드 (`MainVoteQRCode.tsx`)
  - [x] 참여코드 입력 페이지 QR
  - [x] 설정 페이지에 표시
  - [x] 다운로드 전용 (인쇄 제거)
- [x] 투표 상세 페이지에 QR 섹션 추가
- [x] 활용 방법 안내 포함

### 3.3 마을 관리 고도화 ✅
- [x] 마을 활성화/비활성화 기능
  - [x] `is_active` 컬럼 추가 (supabase-migration-v4)
  - [x] 활성화/비활성화 토글 버튼
  - [x] 필터링 기능 (전체/활성화/비활성화)
  - [x] 테이블 레이아웃으로 변경
  - [x] 생성 날짜 표시

### 3.4 투표 상세 페이지 개선 ✅
- [x] 탭 기반 네비게이션 추가
  - [x] 📋 개요 탭 (투표 정보 + 후보자 관리)
  - [x] 🔑 코드 관리 탭 (투표별 코드 생성)
  - [x] 📊 실시간 모니터 탭
  - [x] 📈 결과 확인 탭
- [x] 투표별 코드 생성 기능
  - [x] 코드 생성 모달
  - [x] 1-100개 일괄 생성
  - [x] 필터링 (전체/투표완료/참석확인/미참석)
  - [x] nanoid 사용 10자리 대문자 코드

### 3.5 익명 투표 지원 ✅
- [x] RLS 정책 수정 (supabase-migration-v3)
  - [x] 참여코드 공개 읽기 권한
  - [x] 출석 체크 공개 업데이트 권한
  - [x] 관리자만 코드 생성/삭제
- [x] 출석 추적 기능
  - [x] first_login_at (첫 로그인 시간)
  - [x] last_login_at (마지막 로그인 시간)
  - [x] 투표 페이지에서 자동 기록

### 3.6 투표 라운드 관리 ⏳ (향후 계획)
- [ ] 다회차 투표 지원
  - [ ] 1차 투표 결과 기반 2차 투표 생성
  - [ ] 이전 라운드 상위 N명 자동 후보 등록
  - [ ] 라운드별 결과 비교 페이지
  - [ ] 라운드 연결 관계 표시

---

## 🎨 Phase 4: UI/UX 개선 (이후)

### 4.1 사용자 경험 개선
- [ ] 로딩 스피너 통일 및 컴포넌트화
- [ ] 에러 메시지 토스트/알림 시스템
- [ ] 확인 다이얼로그 컴포넌트 표준화
- [ ] 폼 유효성 검사 메시지 개선
- [ ] 페이지 전환 애니메이션
- [ ] Skeleton UI (로딩 상태)

### 4.2 반응형 디자인 최적화
- [ ] 모바일 레이아웃 개선 (320px ~ 768px)
- [ ] 태블릿 레이아웃 (768px ~ 1024px)
- [ ] 테이블 → 카드 뷰 (모바일)
- [ ] 터치 인터랙션 최적화

### 4.3 접근성 (Accessibility)
- [ ] 키보드 네비게이션
- [ ] ARIA 레이블
- [ ] 색상 대비 검증
- [ ] 스크린 리더 테스트

### 4.4 성능 최적화
- [ ] React Query로 데이터 캐싱 (선택사항)
- [ ] 이미지 최적화
- [ ] 코드 스플리팅
- [ ] Lighthouse 점수 개선 (목표: 90+)


---

## � Phase 5: 배포 및 운영

### 현재 알려진 이슈

- [ ] useEffect 린트 경고 수정 (dashboard, villages 페이지)
- [ ] Markdown 파일 린트 경고 수정 (선택사항)
- [ ] middleware deprecation 경고 해결
- [ ] 투표 상세 페이지 코드 목록 로딩 기능 구현
  - 현재 코드 생성만 가능, 목록 표시는 미구현
  - loadCodes 함수 호출 및 테이블 UI 추가 필요

### 테스트

- [ ] 관리자 로그인 플로우 테스트
- [ ] 투표 생성 플로우 테스트
- [ ] 참여코드 생성 플로우 테스트
- [ ] 실제 투표 플로우 테스트
- [ ] 익명 투표 플로우 테스트 (RLS 정책 확인)
- [ ] 마을 활성화/비활성화 테스트
- [ ] 로고 업로드 및 표시 테스트
- [ ] 색상 테마 변경 테스트
- [ ] QR 코드 생성 및 다운로드 테스트
- [ ] 에러 케이스 테스트

---

## 📱 Phase 5: 배포 및 운영

### 5.1 배포 준비
- [ ] 프로덕션 환경 변수 설정
- [ ] Vercel 배포 설정
- [ ] 커스텀 도메인 연결
- [ ] HTTPS 설정
- [ ] 성능 모니터링 설정

### 5.2 문서화
- [ ] README.md 작성
  - [ ] 프로젝트 소개
  - [ ] 설치 방법
  - [ ] 사용 방법
- [ ] API 문서 작성
- [ ] 관리자 매뉴얼 작성
- [ ] 투표자 가이드 작성

### 5.3 운영
- [ ] 백업 전략 수립
- [ ] 모니터링 도구 설정
- [ ] 에러 추적 (Sentry 등)
- [ ] 사용자 피드백 수집

---

## 📝 작업 시작 전 체크리스트

매 작업 시작 전:
- [x] `npm run dev` 서버 실행 확인
- [x] Supabase 연결 확인
- [ ] Git 브랜치 확인 (필요시)
- [ ] 이전 작업 커밋 (필요시)

---

## 📅 다음 작업 계획

### ✅ 완료: Phase 1.1 - 투표 생성 페이지

1. ✅ `/admin/elections` 투표 목록 페이지 생성
2. ✅ `/admin/elections/create` 투표 생성 페이지 생성
3. ✅ `/admin/elections/[id]` 투표 상세 페이지 생성
4. ✅ 투표 생성 폼 UI 구현
5. ✅ 후보자 동적 추가/삭제 기능
6. ✅ 투표 생성 API 연결
7. ✅ 폼 유효성 검사
8. ✅ 상태 관리 기능 (대기/등록중/진행중/종료)

**소요 시간**: 약 2시간

### ✅ 완료: Phase 1.2 - 참여코드 생성 및 관리 (기본)

1. ✅ `/admin/codes` 페이지 생성
2. ✅ 코드 목록 조회 및 필터링
3. ✅ 단순 생성 모드 구현
4. ✅ 코드 통계 대시보드
5. ✅ 검색 및 삭제 기능

**소요 시간**: 약 1.5시간

### ✅ 완료: Phase 1.3 - 실제 투표 기능

1. ✅ `/vote` 참여코드 입력 페이지 개선
2. ✅ `/vote/[code]` 투표 진행 페이지 구현
3. ✅ 코드 유효성 검사
4. ✅ 후보자 선택 UI (단일/복수 선택 지원)
5. ✅ 투표 제출 및 중복 방지
6. ✅ 투표 완료 페이지
7. ✅ 득표수 자동 증가 RPC 함수

**소요 시간**: 약 2시간

### 🎯 다음 작업: Phase 4 - UI/UX 개선

**우선순위: 중간** �

1. **반응형 디자인 최적화**
   - 모바일 레이아웃 개선 (320px ~ 768px)
   - 테이블 → 카드 뷰 전환 (모바일)
   - 터치 인터랙션 최적화

2. **사용자 경험 개선**
   - 로딩 상태 개선 (Skeleton UI)
   - 에러/성공 토스트 알림
   - 확인 다이얼로그 표준화
   - 페이지 전환 애니메이션

3. **성능 최적화**
   - 이미지 최적화
   - 코드 스플리팅
   - Lighthouse 점수 개선

**예상 소요 시간**: 3-4시간

**완료 후**: Phase 5 (배포 및 테스트)

---

### 🎯 이후 작업 계획

**Phase 3.6: 투표 라운드 관리** (향후, 1-2시간)
- 다회차 투표 생성
- 라운드 연결 및 결과 비교

**Phase 5: 배포 준비** (1-2시간)
- 프로덕션 배포
- 테스트 및 문서화

---

### ✅ 최근 완료: Phase 3 전체 완료

**Phase 3.1 - 시스템 설정 페이지 완료** ✅
- ✅ `/admin/settings` 페이지 생성
- ✅ 관리자 이메일 목록 조회
- ✅ 관리자 추가 기능 (이메일 검증 포함)
- ✅ 관리자 삭제 기능 (본인/마지막 관리자 보호)
- ✅ 시스템 이름 설정 (system_config 테이블)
- ✅ 로고 업로드 및 관리 (`LogoUploadSettings.tsx`)
- ✅ 색상 테마 커스터마이징 (`ColorThemeSettings.tsx`)
- ✅ 전역 로고 컴포넌트 (`SystemLogo.tsx`)
- ✅ 테마 프로바이더 (`ThemeProvider.tsx`)

**Phase 3.2 - QR 코드 기능 완료** ✅
- ✅ QR 코드 생성 라이브러리 설치 (qrcode.react)
- ✅ 투표별 QR 코드 컴포넌트 (`QRCodeSection.tsx`)
- ✅ 메인 투표 페이지 QR 코드 (`MainVoteQRCode.tsx`)
- ✅ PNG 다운로드, 인쇄, URL 복사 기능
- ✅ 투표 상세 페이지에 QR 섹션 추가

**Phase 3.3 - 마을 관리 고도화 완료** ✅
- ✅ 마을 활성화/비활성화 기능
- ✅ `is_active` 컬럼 추가 (migration v4)
- ✅ 테이블 레이아웃으로 UI 개선
- ✅ 필터링 기능 (전체/활성화/비활성화)

**Phase 3.4 - 투표 상세 페이지 개선 완료** ✅
- ✅ 탭 기반 네비게이션 (4개 탭)
- ✅ 투표별 코드 생성 기능
- ✅ 코드 생성 모달 (1-100개 일괄)
- ✅ 필터링 (전체/투표완료/참석확인/미참석)

**Phase 3.5 - 익명 투표 지원 완료** ✅
- ✅ RLS 정책 수정 (migration v3)
- ✅ 출석 추적 (first_login_at, last_login_at)
- ✅ 투표 페이지 자동 기록

---

## 🎯 현재 진행 상황

**완료율**: 약 90% ⭐ (기본 인프라, 관리자 기능, 투표 관리, 참여코드 관리, 실제 투표 기능, 모니터링 및 결과, 추가 기능 대부분)

**최근 완료**: Phase 3 - 추가 기능 구현 완료 ✅
- 시스템 설정 페이지 (로고/색상 테마 커스터마이징)
- QR 코드 기능
- 마을 활성화/비활성화
- 투표 상세 페이지 탭 네비게이션
- 익명 투표 지원
- 투표별 코드 생성

**다음 마일스톤**: Phase 4 (UI/UX 개선) → 95% 완료 예상

**현재 상태**: 
- ✅ 모든 핵심 기능 작동
- ✅ 관리자 페이지 완성 (10개)
- ✅ 투표자 페이지 완성 (4개)
- ✅ 커스터마이징 가능 (로고, 색상)
- ✅ Apple 스타일 디자인 적용
- ⏳ 반응형 개선 및 성능 최적화 대기

---

**마지막 업데이트**: 2025-11-10 - Phase 3 완료 (시스템 커스터마이징, 마을 관리, 투표 코드 관리 개선, 익명 투표)
